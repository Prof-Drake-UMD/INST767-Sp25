name: "metro-job"
priority: 70
taskGroups:
  - taskSpec:
      runnables:
        - script:
            text: |
              #!/bin/bash
              sudo apt-get update
              sudo apt-get install -y python3 python3-pip
              command -v python || sudo ln -s /usr/bin/python3 /usr/bin/python
              command -v pip || sudo ln -s /usr/bin/pip3 /usr/bin/pip
              python -m pip install --upgrade pip
              python -m pip install python-dotenv requests pandas google-cloud-storage
              gsutil cp gs://api_output_bucket_inst_final/scripts/main.py .
              python main.py

      computeResource:
        cpuMilli: 2000
        memoryMib: 4096
      maxRunDuration: "7200s"
      maxRetryCount: 1
    taskCount: 1
allocationPolicy:
  instances:
    - policy:
        machineType: e2-standard-4
logsPolicy:
  destination: CLOUD_LOGGING
  logsPath: "/logs/"
